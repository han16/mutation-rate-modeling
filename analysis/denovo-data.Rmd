---
title: "De novo mutations of ASD"
author: "Shengtong  Han"
date: YYYY-MM-DD
output: html_document
---

<!-- The file analysis/chunks.R contains chunks that define default settings
shared across the workflowr files. -->
```{r read-chunk, include=FALSE, cache=FALSE}
knitr::read_chunk("chunks.R")
library(knitr)
```

<!-- Update knitr chunk options -->
```{r knitr-opts-chunk, include=FALSE}
```

<!-- Insert the date the file was last updated -->
```{r last-updated, echo=FALSE, results='asis'}
```

<!-- Insert the code version (Git commit SHA1) if Git repository exists and R
 package git2r is installed -->
```{r code-version, echo=FALSE, results='asis'}
```

## Samples



### Case Samples 



index    | Samples | \# mutations| \# subjects
----|-------|-------|---
1 | Jiang_cases_DNM.bed | 2,091| 32
2 | Michaelson_cases_DNM.bed |581 | 10
3 | Yuen_NM2015_cases_DNM.bed | 9,381| 162
4 | Wu_cases_DNM.bed | 1,915 | 32
5 | Kong_cases_DNM.bed | 4,930 | 78

Table: Five WGS  DNM case sample information



### Wong_NC_2016_693_control_SNV- Control sample 

index    | Samples | \# mutations| \# subjects
----|-------|-------|---
1 | Wong_NC_2016_693_control_SNV.bed | 27,092|  693
2 | A->C | 990 (3.65%) | 
3 | A->G | 3,812 (14.07%) |
4 | A->T | 815 (3.01%) |
5 | C->G | 1,274 (4.70%) |
6 | C->T | 5,314 (19.61%) |
7 | C->A | 1,298 (4.79%) |
Table:WGS  DNM control sample information 

```{r, echo=F}
slices <- c(990, 3812, 815, 1274, 5314, 1298) 
lbls <- c("A->C", "A->G", "A->T", "C->G", "C->T", "C->A")
pct <- round(slices/sum(slices)*100)
lbls <- paste(lbls, pct) # add percents to labels 
lbls <- paste(lbls,"%",sep="") # ad % to labels 
pie(slices,labels = lbls, col=rainbow(length(lbls)),
  	main="Percentage of mutation types in Wong_NC_2016_693_control_SNV ")
```


There are 585,017,944 C's  and 844,868,045 A's in hg19. 



### Jonsson_Yuen2017
De novo WGS of the combination of 1629 ASD cases and 1548 controls. 

index    | mutation type | \# mutations
----|-------|-------|---
1 | A->C | 7,821   
2 | A->G | 29,370  
3 | A->T | 7,417
4 | C->G | 10,255 
5 | C->T | 45,638 
6 | C->A | 9,804

```{r, echo=F}
slices <- c(7821, 29370, 7417, 10255, 45638, 9804) 
lbls <- c("A->C", "A->G", "A->T", "C->G", "C->T", "C->A")
pct <- round(slices/sum(slices)*100)
lbls <- paste(lbls, pct) # add percents to labels 
lbls <- paste(lbls,"%",sep="") # ad % to labels 
pie(slices,labels = lbls, col=rainbow(length(lbls)),
  	main="Percentage of mutation types in Jonsson_Yuen2017 ")
```

## Data processing and model fitting 

### Data discretization and categorization

* Continuous features are categorized into 50 quantile intervals, and observations in every interval use the same discretized value of the mean 
* use R function Split to cluster windows with similar features including discrete features and categorized features 

### Model fitting 

We use two methods to fit the model 

* GLM (use R function GLM)
  
  $$y\sim Pois( e^{\mu+X^T\beta})$$

  (1) The response is the ** number of mutations ** in the unit(base window or category) and the each feature is base level or  averaged across all windows within the category (denoted as M2 (method 2))
  
  (2) intercept is included and the same across all categories
  (3) confidence interval could be obtained as well

* use R function optim to fit the model (M1 method)

 (1)  use estimated baseline mutation rate in the model. 
 (2)  There is a singularity problem for hessian matrix when getting the confidence interval by optim. 



## Wong_NC_2016_693_control_SNV 

The window length is set 100 bp. Use GLN to fit the model, and stated otherwise. 

### Whole genome NO categorization-one feature

For each mutation type in the above table, fit the Poisson regression on the feature DHS 


mutation type| $\hat{\beta}_0$ (intercept) | $\hat{\beta_1}$ (DHS)
---|-----|-------------|------
 A->C | -10.47 | 0.45
 A->G | -9.08 | 0.33
 A->T | -10.62 | 0.30
 C->G | -10.31 | 0.75
 C->T | -8.87 | 0.70
 C->A | -10.24 | 0.60 
 
 
```{r, echo=T}
 inter=c(-10.47, -9.08, -10.62, -10.31, -8.87, -10.24)
 DHS=matrix(nrow=6, ncol=1)
 DHS[,1]=c(0.45, 0.33, 0.30, 0.75, 0.70, 0.60)
 rownames(DHS)=c("A->C", "A->G", "A->T", "C->G", "C->T", "C->A")
 barplot(DHS[,1], col=" blue", xlab="", ylab="DHS (whole genome)")
```
 

### whole genome NO categorization-3 discrete features (at most)


mutation type| $\hat{\beta}_0$ | $\hat{\beta_1}$  | $\hat{\beta_2}$ | $\hat{\beta_3}$ | $\hat{\beta_4}$ | $\hat{\beta_5}$
---|-----|-------------|------|-----|----|-----| 
A->C |-10.47 | 0.45 | | | | 
 A->C | -10.47 | 0.46 | -0.10 | | |
 A->C | -10.51 | 0.47 | -0.08 | 0.11 | |
 A->C (chr1 )| -11.23 | 0.14 | -0.44 | 0.13| 1.53 |
 A->C (chr1) | -11.24 | 0.16 | -0.44 | 0.09 | 1.62 | -0.87 |
 Table: $\beta_0, \beta_1, \beta_2, \beta_3$ are for intercept, DHS,  CpG island and lamin. 



### whole genome with categorization-5 features 

```{r, echo=F}
AtoC=read.csv("D:\\ResearchWork\\StatisticalGenetics\\Mutation-Rate-project\\mutation_A_to_C_para.est.optim.50cate.csv", header=T)
AtoG=read.csv("D:\\ResearchWork\\StatisticalGenetics\\Mutation-Rate-project\\mutation_A_to_G_para.est.optim.50cate.csv", header=T)
AtoT=read.csv("D:\\ResearchWork\\StatisticalGenetics\\Mutation-Rate-project\\mutation_A_to_T_para.est.optim.50cate.csv", header=T)
CtoG=read.csv("D:\\ResearchWork\\StatisticalGenetics\\Mutation-Rate-project\\mutation_C_to_G_para.est.optim.50cate.csv", header=T)
CtoT=read.csv("D:\\ResearchWork\\StatisticalGenetics\\Mutation-Rate-project\\mutation_C_to_T_para.est.optim.50cate.csv", header=T)
CtoA=read.csv("D:\\ResearchWork\\StatisticalGenetics\\Mutation-Rate-project\\mutation_C_to_A_para.est.optim.50cate.csv", header=T)
combine=matrix(nrow=6, ncol=5)
combine[1,]=AtoC[,2]
combine[2,]=AtoG[,2]
combine[3,]=AtoT[,2]
combine[4,]=CtoG[,2]
combine[5,]=CtoT[,2]
combine[6,]=CtoA[,2]
rownames(combine)=c("A->C", "A->G", "A->T", "C->G", "C->T", "C->A")
colnames(combine)=c( "DHS", "CpGisland", "lamin", "gc", "RT")
```

```{r, echo=T}
#kable(combine, digits=2, format="html", caption="Estimated effect of five features", align="c")
```


```{r dhs, echo=F}
optim.para=read.csv("D:\\ResearchWork\\StatisticalGenetics\\Mutation-Rate-project\\parameter_estimate\\para.est.by.optim.csv", header=T, row.names=NULL)
glm.total.mut.para=read.csv("D:\\ResearchWork\\StatisticalGenetics\\Mutation-Rate-project\\parameter_estimate\\para.est.by.glm.use.log.as.offset.csv", header=T)
conf.inter=load("D:\\ResearchWork\\StatisticalGenetics\\Mutation-Rate-project\\parameter_estimate\\para.conf.by.glm.use.log.as.offset.RData")
names(conf.with.log)=optim.para[,1]
for (i in 1:length(conf.with.log))
   rownames(conf.with.log[[i]])=colnames(glm.total.mut.para)[2:7]
#glm.total.mut.para=read.csv("D:\\ResearchWork\\StatisticalGenetics\\Mutation-Rate-project\\parameter_estimate\\para.est.by.glm.use.total.mutation.as.response.csv", header=T)
#glm.ave.mut.para=read.csv("D:\\ResearchWork\\StatisticalGenetics\\Mutation-Rate-project\\parameter_estimate\\para.est.by.glm.use.average.mutation.as.response.csv", header=T)
```


```{r, echo=F}
num.method=2; num.mut=6
DHS=matrix(nrow=num.method, ncol=num.mut)
DHS[1,]=optim.para$DHS
DHS[2,]=glm.total.mut.para$DHS
colnames(DHS)=optim.para[,1]
DHS.conf=matrix(nrow=2, ncol=num.mut)
for (i in 1:num.mut)
  DHS.conf[,i]=conf.with.log[[i]][rownames(conf.with.log[[i]])=="DHS",]
barCenters=barplot(DHS, beside=T, col=c("red", "darkblue"), legend=c("M1", "M2"), ylim=c(min(DHS), max(DHS)), main="DHS by different methods")
segments(barCenters[2,], DHS.conf[1,], barCenters[2,],
         DHS.conf[2,], lwd = 1.5)

arrows(barCenters[2,], DHS.conf[1,], barCenters[2,],
       DHS.conf[2,], lwd = 1.5, angle = 90,
       code = 3, length = 0.05)
```

```{r, echo=F}
CpG=matrix(nrow=num.method, ncol=num.mut)
CpG[1,]=optim.para$CpGIsland
CpG[2,]=glm.total.mut.para$CpGIsland
colnames(CpG)=optim.para[,1]

CpG.conf=matrix(nrow=2, ncol=num.mut)
for (i in 1:num.mut)
  CpG.conf[,i]=conf.with.log[[i]][rownames(conf.with.log[[i]])=="CpGIsland",]
barCenters=barplot(CpG, beside=T, col=c("red", "darkblue"), legend=c("M1", "M2"), ylim=c(min(CpG), max(CpG)), main="DHS by different methods")
segments(barCenters[2,], CpG.conf[1,], barCenters[2,],
         CpG.conf[2,], lwd = 1.5)

arrows(barCenters[2,], CpG.conf[1,], barCenters[2,],
       CpG.conf[2,], lwd = 1.5, angle = 90,
       code = 3, length = 0.05)

```


```{r, cecho=F}
lamin=matrix(nrow=num.method, ncol=num.mut)
lamin[1,]=optim.para$Lamin
lamin[2,]=glm.total.mut.para$Lamin
colnames(lamin)=optim.para[,1]

barplot(lamin, beside=T, col=c("red", "darkblue"), legend=c("M1", "M2"), ylim=c(min(lamin), 0.1), main="Lamin by different methods")


GC=matrix(nrow=num.method, ncol=num.mut)
GC[1,]=optim.para$GC
GC[2,]=glm.total.mut.para$GC
colnames(GC)=optim.para[,1]

barplot(GC, beside=T, col=c("red", "darkblue"), legend=c("M1", "M2"), ylim=c(min(GC), max(GC)), main="GC content by  different methods")

Reptime=matrix(nrow=num.method, ncol=num.mut)
Reptime[1,]=optim.para$RepTime
Reptime[2,]=glm.total.mut.para$RepTime
colnames(Reptime)=optim.para[,1]

barplot(Reptime, beside=T, col=c("red", "darkblue"), legend=c("M1", "M2"), ylim=c(min(Reptime), max(Reptime)+0.2), main="Replication timing by  different methods")


Inter=matrix(nrow=1, ncol=6)
Inter[1,]=glm.total.mut.para$Intercept
colnames(Inter)=optim.para[,1]

barplot(Inter, beside=T, col=c( "darkblue"), legend=c( "M2"), ylim=c(min(Inter), max(Inter)), main="Intercept by  GLM ")


```



## Session information


<!-- Insert the session information into the document -->
```{r session-info}
```
