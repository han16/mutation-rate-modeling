---
title: "De novo mutations of ASD"
author: "Shengtong  Han"
date: YYYY-MM-DD
output: html_document
---

<!-- The file analysis/chunks.R contains chunks that define default settings
shared across the workflowr files. -->
```{r read-chunk, include=FALSE, cache=FALSE}
knitr::read_chunk("chunks.R")
library(knitr)
library(kableExtra)
library(RColorBrewer)
library(gplots)
library(ape)
set.seed(123)
```


```{r, echo=F}
loadRData <- function(fileName){
#loads an RData file, and returns it
    load(fileName)
    get(ls()[ls() != "fileName"])
}
```


## Samples



### Case Samples 



index    | Samples | \# mutations| \# subjects
----|-------|-------|---
1 | Jiang_cases_DNM.bed | 2,091| 32
2 | Michaelson_cases_DNM.bed |581 | 10
3 | Yuen_NM2015_cases_DNM.bed | 9,381| 162
4 | Wu_cases_DNM.bed | 1,915 | 32
5 | Kong_cases_DNM.bed | 4,930 | 78

Table: Five WGS  DNM case sample information

* Jiang_cases_DNM.bed [Detection of clinically relevant genetic variants in autism spectrum disorder by whole-genome sequencing](https://pubmed.ncbi.nlm.nih.gov/23849776/), AJHG 2013. 

* Michaelson_cases_DNM.bed [Whole-genome sequencing in autism identifies hot spots for de novo germline mutation](https://pubmed.ncbi.nlm.nih.gov/23260136/), cell, 2012

* Yuen_NM2015_cases_DNM.bed [Whole-genome sequencing of quartet families with autism spectrum disorder](https://pubmed.ncbi.nlm.nih.gov/25621899/), nature medicine, 2015

* Wu_cases_DNM.bed [unpublished]

* Kong_cases_DNM.bed [Rate of de novo mutations and the importance of father's age to disease risk](https://www.nature.com/articles/nature11396), nature, 2012



### Wong_NC_2016_693_control_SNV- Control sample 

index    | Samples | \# mutations| \# subjects
----|-------|-------|---
1 | Wong_NC_2016_693_control_SNV.bed | 27,092|  693
2 | A->C | 990 (3.65%) | 
3 | A->G | 3,812 (14.07%) |
4 | A->T | 815 (3.01%) |
5 | C->G | 1,274 (4.70%) |
6 | C->T | 5,314 (19.61%) |
7 | C->A | 1,298 (4.79%) |
Table:WGS  DNM control sample information 

```{r, echo=F}
slices <- c(990, 3812, 815, 1274, 5314, 1298) 
lbls <- c("A->C", "A->G", "A->T", "C->G", "C->T", "C->A")
pct <- round(slices/sum(slices)*100)
lbls <- paste(lbls, pct) # add percents to labels 
lbls <- paste(lbls,"%",sep="") # ad % to labels 
pie(slices,labels = lbls, col=rainbow(length(lbls)),
  	main="Percentage of mutation types in Wong_NC_2016_693_control_SNV ")
```


There are 585,017,944 C's  and 844,868,045 A's in hg19. 



### Jonsson

De novo WGS of Jonsson data has 1548 controls. 

index    | mutation type | \# mutations
----|-------|-------|---
1 | A->C | 3,582
2 | A->G | 13,477  
3 | A->T | 3,331
4 | C->G | 4,822
5 | C->T | 21,220 
6 | C->A | 3,862

```{r, echo=F}
slices <- c(3582, 13477, 3331, 4822, 21220, 3862) 
lbls <- c("A->C", "A->G", "A->T", "C->G", "C->T", "C->A")
pct <- round(slices/sum(slices)*100)
lbls <- paste(lbls, pct) # add percents to labels 
lbls <- paste(lbls,"%",sep="") # ad % to labels 
pie(slices,labels = lbls, col=rainbow(length(lbls)),
  	main="Percentage of mutation types in Jonsson data ")
```

### Simons-control


WGS Simons control data

index    | mutation type | \# mutations
----|-------|-------|---
1 | A->C | 3,899
2 | A->G | 15,083  
3 | A->T | 3,664
4 | C->G | 5,393
5 | C->T | 23,977 
6 | C->A | 5,404

```{r, echo=F}
slices <- c(3899, 15083, 3664, 5393, 23977, 5404) 
lbls <- c("A->C", "A->G", "A->T", "C->G", "C->T", "C->A")
pct <- round(slices/sum(slices)*100)
lbls <- paste(lbls, pct) # add percents to labels 
lbls <- paste(lbls,"%",sep="") # ad % to labels 
pie(slices,labels = lbls, col=rainbow(length(lbls)),
  	main="Percentage of mutation types in Simons control data ")
```

### Yuen data 

Yuen data 

index    | mutation type | \# mutations
----|-------|-------|---
1 | A->C | 4,239
2 | A->G | 15,893  
3 | A->T | 4,086
4 | C->G | 5,433
5 | C->T | 24,418 
6 | C->A | 5,942

```{r, echo=F}
slices <- c(4239, 15893, 4086, 5433, 24418, 5942) 
lbls <- c("A->C", "A->G", "A->T", "C->G", "C->T", "C->A")
pct <- round(slices/sum(slices)*100)
lbls <- paste(lbls, pct) # add percents to labels 
lbls <- paste(lbls,"%",sep="") # ad % to labels 
pie(slices,labels = lbls, col=rainbow(length(lbls)),
  	main="Percentage of mutation types in Yuen data ")
```

### Sample summary

index    | mutation type |  Wong-control| Jonsson | simons-control| Yuen
----|-------|-------|------------|-----------|-
1 | A->C | 990 (3.65%) |  3,582 | 3,899 | 4,239
2 | A->G | 3,812 (14.07%) |13,477 | 15,083 | 15,893
3 | A->T | 815 (3.01%) | 3,331 | 3,664 | 4,086
4 | C->G | 1,274 (4.70%) |4,822 | 5,393 | 5,433
5 | C->T | 5,314 (19.61%) | 21,220 | 23,977 | 24,418
6 | C->A | 1,298 (4.79%) | 3,862 | 5,404 | 5,942

```{r, echo=T, eval=F}
Wong data: /project2/xinhe/Shengtong/mutation_rate/mutation.rate/Wong_NC_2016_693_control_SNV_with_allele_info.txt
Jonson: /project2/xinhe/Shengtong/mutation_rate/mutation.rate/Jonsson_Yuen2017/comb_SNPs_Jonsson
Yuen:  /project2/xinhe/Shengtong/mutation_rate/mutation.rate/Jonsson_Yuen2017/comb_SNPs_Yuen
Simons: /project2/xinhe/Shengtong/mutation_rate/mutation.rate/Simons_WGS
```


* Wong data: [New observations on maternal age effect on germline de novo mutation](https://www.nature.com/articles/ncomms10486), nature communications, 2016

* Jonson, [Whole genome characterization of sequence diversity of 15,220 Icelanders](https://www.nature.com/articles/sdata2017115), Scientific Data, 2017

* Simons: [Genomic Patterns of De Novo Mutation in Simplex Autism](https://pubmed.ncbi.nlm.nih.gov/28965761/), cell, 2017

```{r, echo=T, eval=F}
Folder: /project2/xinhe/Shengtong/mutation_rate/mutation.rate/Simons_WGS/controls
Data for 100bp window: table.ASCWGS_20180504.WGS1902_hg19_controls_SNV_remove_recurrent_mutation.ExpObsVar.bed.bed.add.100bp
Each row shows data of one 100bp window. Each column: chromosome, start, end, observed DNM count in the window, and fitted mutation rate in the window. 

chr1 	 0 	 100 0 	 0
chr1 	 100 	 200 0 	 0
chr1 	 200 	 300 0 	 0
chr1 	 300 	 400 0 	 0
chr1 	 400 	 500 0 	 0
chr1 	 500 	 600 0 	 0
chr1 	 600 	 700 0 	 0
chr1 	 700 	 800 0 	 0
chr1 	 800 	 900 0 	 0
chr1 	 900 	 1000 0 	 0

```


## Data processing and model fitting 

### Data discretization and categorization

* Continuous features are converted  into  binary discrete variables.  
* use R function Split to cluster windows with similar binary (original and converted) features.  

### Model fitting for each mutation type separately 

There are two ways to fit the model, GLM and optims. Both methods give the same esrimate either for whole genome or categorized windows as whown in simulations. Here only present the result by GLM with categorization,   

* GLM (use R function GLM) with offset term
  
  $$y\sim Pois( e^{\mu+X^T\beta})$$

  
  (1) With categorization,  response   $y$ is the **total number of mutations** from all windows  within a category and covariate feature
  (2) offset term uses 7-mer ERV baseline mutation rate, which is sum of 7-mer mutation rate in a window for each mutation type, e.g. for A->C, sum over all 7-mer mutation rate with A->C in the center.     
  
  (2) intercept is included and the same across all categories
  (3) confidence interval could be obtained as well


## ERV baseline mutation rate 

index  | mutation type |  mutations rate  
----|-------|-------|---
1 | A->C | $1.6627\times 10^{-9}$   
2 | A->G | $6.1805 \times 10^{-9}$
3 | A->T | $1.5633 \times 10^{-9}$
4 | C->G | $2.8075 \times 10^{-9}$
5 | C->T | $1.2885 \times 10^{-8}$
6 | C->A | $3.3977 \times 10^{-9}$
Table: Average mutation rate of different mutation types in ERV paper. 


## Whole genome-fit 14 features simultaneously   

The window length is set 100 bp. Use GLM to fit the model, and stated otherwise. 




```{r, echo=F}
mut.type=c("A_to_C", "A_to_G", "A_to_T", "C_to_A.CpG","C_to_A.nonCpG", "C_to_G.CpG", "C_to_G.nonCpG", "C_to_T.CpG", "C_to_T.nonCpG")
cova=c("DHS", "CpGisland", "Lamin", "GC", "RT", "RR", "Exon", "H3K27ac", "H3K27me3", "H3K36me3", "H3K4me1","H3K4me3","H3K9ac", "H3K9me3")
```


```{r, echo=F}
wong.control.para.est=list(); simons.control.para.est=list(); jonsson.para.est=list()
yuen.para.est=list()
for (i in 1:length(mut.type))
{
  wong.control.para.est[[i]]=loadRData(paste("..\\..\\parameter_estimate\\Wong_NC_2016_693_control_SNV_100bp.window_mutation", mut.type[i], "RData", sep="."))
  simons.control.para.est[[i]]=loadRData(paste("..\\..\\parameter_estimate\\Simons\\table.ASCWGS_20180504.WGS1902_hg19_controls_SNV_remove_recurrent_mutation", mut.type[i], "RData", sep="."))
  jonsson.para.est[[i]]=loadRData(paste("..\\..\\parameter_estimate\\Jonsson_Yuen\\comb_SNPs_Jonsson.mutation", mut.type[i], "RData", sep="."))
  yuen.para.est[[i]]=loadRData(paste("..\\..\\parameter_estimate\\Jonsson_Yuen\\comb_SNPs_Yuen.mutation", mut.type[i], "RData", sep="."))
}
names(wong.control.para.est)=mut.type
names(simons.control.para.est)=mut.type
names(jonsson.para.est)=mut.type
names(yuen.para.est)=mut.type
```

```{r, echo=F}
for (cova.index in 1:length(cova))
{
#  cova.index=1
cova.across.mut=matrix(nrow=4, ncol=length(mut.type))

wong.control.conf.inter=matrix(nrow=length(mut.type), ncol=2)
colnames(wong.control.conf.inter)=c("lower", "upper")
rownames(wong.control.conf.inter)=names(wong.control.para.est)

simons.control.conf.inter=matrix(nrow=length(mut.type), ncol=2)
colnames(simons.control.conf.inter)=c("lower", "upper")
rownames(simons.control.conf.inter)=names(simons.control.para.est)

jonsson.conf.inter=matrix(nrow=length(mut.type), ncol=2)
colnames(jonsson.conf.inter)=c("lower", "upper")
rownames(jonsson.conf.inter)=names(jonsson.para.est)

yuen.conf.inter=matrix(nrow=length(mut.type), ncol=2)
colnames(yuen.conf.inter)=c("lower", "upper")
rownames(yuen.conf.inter)=names(yuen.para.est)

for (i in 1:length(mut.type))
{
  cova.across.mut[1,i]=wong.control.para.est[[i]]$para.est[cova.index+1]
  wong.control.conf.inter[i,]=wong.control.para.est[[i]]$para.conf[cova.index+1,]
  
  cova.across.mut[2,i]=simons.control.para.est[[i]]$para.est[cova.index+1]
  simons.control.conf.inter[i,]=simons.control.para.est[[i]]$para.conf[cova.index+1,]
  
  cova.across.mut[3,i]=jonsson.para.est[[i]]$para.est[cova.index+1]
  jonsson.conf.inter[i,]=jonsson.para.est[[i]]$para.conf[cova.index+1, ]
  
  cova.across.mut[4,i]=yuen.para.est[[i]]$para.est[cova.index+1]
  yuen.conf.inter[i,]=yuen.para.est[[i]]$para.conf[cova.index+1, ]
  
}
colnames(cova.across.mut)=names(wong.control.para.est)

barcenters=barplot(cova.across.mut, beside=T,ylab=expression(paste(beta)),col=c("red", "blue", "green", "yellow"), legend=c("Wong_contr", "simons_contr", "jonsson", "yuen"), ylim=c(min(wong.control.conf.inter, simons.control.conf.inter, jonsson.conf.inter, yuen.conf.inter, cova.across.mut), max(wong.control.conf.inter, simons.control.conf.inter, jonsson.conf.inter, yuen.conf.inter,cova.across.mut)),  main=cova[cova.index],  cex.names=0.65, args.legend = list(x ='topright', bty='n', inset=c(-0.005,0), cex=0.8), xpd = FALSE, las=2)


segments(barcenters, rbind(wong.control.conf.inter[,1], simons.control.conf.inter[,1], jonsson.conf.inter[,1], yuen.conf.inter[,1]), barcenters,rbind(wong.control.conf.inter[,2], simons.control.conf.inter[,2], jonsson.conf.inter[,2], yuen.conf.inter[,2]), lwd = 1.5)

arrows(barcenters, rbind(wong.control.conf.inter[,1], simons.control.conf.inter[,1], jonsson.conf.inter[,1], yuen.conf.inter[,1]), barcenters,rbind(wong.control.conf.inter[,2], simons.control.conf.inter[,2], jonsson.conf.inter[,2], yuen.conf.inter[,2]), lwd = 1.5, angle = 90,code = 3, length = 0.05)
} # end of cova.index
```


* Fit 14 covariate features simultaneously.

* 95% confidence interval by GLM is often big.  



#### Parameter estimate comparison 



```{r, echo=F}
mut.type=c("A_to_C", "A_to_G", "A_to_T")
cova=c("DHS", "CpGisland", "Lamin", "GC", "RT", "RR", "Exon", "H3K27ac", "H3K27me3", "H3K36me3", "H3K4me1","H3K4me3","H3K9ac", "H3K9me3")
```


```{r, echo=F}
simons.control.para.est.100bp=list(); simons.control.para.est.100k=list()
simons.control.para.est.10k=list()
for (i in 1:length(mut.type))
{
  simons.control.para.est.100bp[[i]]=loadRData(paste("..\\..\\parameter_estimate\\Simons\\table.ASCWGS_20180504.WGS1902_hg19_controls_SNV_remove_recurrent_mutation", mut.type[i], "RData", sep="."))
 simons.control.para.est.100k[[i]]=loadRData(paste("..\\..\\parameter_estimate\\Simons\\100kwindow\\table.ASCWGS_20180504.WGS1902_hg19_controls_SNV_remove_recurrent_mutation", mut.type[i], "RData", sep="."))
 simons.control.para.est.10k[[i]]=loadRData(paste("..\\..\\parameter_estimate\\Simons\\10kwindow\\table.ASCWGS_20180504.WGS1902_hg19_controls_SNV_remove_recurrent_mutation", mut.type[i], "RData", sep="."))
 
}
names(simons.control.para.est.100bp)=mut.type
names(simons.control.para.est.100k)=mut.type
names(simons.control.para.est.10k)=mut.type
```

```{r, echo=F}
for (cova.index in 1:length(cova))
{
#  cova.index=1
cova.across.mut=matrix(nrow=3, ncol=length(mut.type))


simons.control.conf.inter=matrix(nrow=length(mut.type), ncol=2)
colnames(simons.control.conf.inter)=c("lower", "upper")
rownames(simons.control.conf.inter)=names(simons.control.para.est.100bp)

simons.control.conf.inter.100k=matrix(nrow=length(mut.type), ncol=2)
colnames(simons.control.conf.inter.100k)=c("lower", "upper")
rownames(simons.control.conf.inter.100k)=names(simons.control.para.est.100k)

simons.control.conf.inter.10k=matrix(nrow=length(mut.type), ncol=2)
colnames(simons.control.conf.inter.10k)=c("lower", "upper")
rownames(simons.control.conf.inter.10k)=names(simons.control.para.est.10k)


for (i in 1:length(mut.type))
{
  
  cova.across.mut[1,i]=simons.control.para.est.100bp[[i]]$para.est[cova.index+1]
  simons.control.conf.inter[i,]=simons.control.para.est.100bp[[i]]$para.conf[cova.index+1,]
  
  cova.across.mut[3,i]=simons.control.para.est.100k[[i]]$para.est[cova.index+1]
  simons.control.conf.inter.100k[i,]=simons.control.para.est.100k[[i]]$para.conf[cova.index+1,]
  
  cova.across.mut[2,i]=simons.control.para.est.10k[[i]]$para.est[cova.index+1]
  simons.control.conf.inter.10k[i,]=simons.control.para.est.10k[[i]]$para.conf[cova.index+1,]
  
}
colnames(cova.across.mut)=names(simons.control.para.est.100bp)

barcenters=barplot(cova.across.mut, beside=T,ylab=expression(paste(beta)),col=c("red", "blue", "green"), legend=c("simons_contr_100bp", "simons_contr_10k", "simons_contr_100k"), ylim=c(min(simons.control.conf.inter, simons.control.conf.inter.100k, simons.control.conf.inter.10k), max(simons.control.conf.inter, simons.control.conf.inter.100k, simons.control.conf.inter.10k)),  main=cova[cova.index],  cex.names=0.65, args.legend = list(x ='topright', bty='n', inset=c(-0.005,0), cex=0.8), xpd = FALSE, las=2)


segments(barcenters, rbind(simons.control.conf.inter[,1], simons.control.conf.inter.10k[,1], simons.control.conf.inter.100k[,1]), barcenters,rbind(simons.control.conf.inter[,2], simons.control.conf.inter.10k[,2], simons.control.conf.inter.100k[,2]), lwd = 1.5)

arrows(barcenters, rbind(simons.control.conf.inter[,1], simons.control.conf.inter.10k[,1], simons.control.conf.inter.100k[,1]), barcenters,rbind(simons.control.conf.inter[,2], simons.control.conf.inter.10k[,2], simons.control.conf.inter.100k[,2]), lwd = 1.5, angle = 90,code = 3, length = 0.05)
} # end of cova.index
```



## Parameter estimate with variable selection



```{r, echo=F}
mut.type=c("A_to_C", "A_to_G", "A_to_T", "C_to_A.CpG","C_to_A.nonCpG", "C_to_G.CpG", "C_to_G.nonCpG", "C_to_T.CpG", "C_to_T.nonCpG")
cova=c("DHS", "CpGisland", "Lamin", "GC", "RT", "RR", "Exon", "H3K27ac", "H3K27me3", "H3K36me3", "H3K4me1","H3K4me3","H3K9ac", "H3K9me3")
```

```{r, echo=F}
simons.control.para.est=list()
for (i in 1:length(mut.type))
{
  simons.control.para.est[[i]]=loadRData(paste("..\\..\\parameter_estimate\\Simons\\100bpwindow_varselection\\table.ASCWGS_20180504.WGS1902_hg19_controls_SNV_remove_recurrent_mutation", mut.type[i], "var.selection.RData", sep="."))
}
```


```{r, echo=F}
for (mut in 1:length(mut.type))
{
#  mut=1
pick.cova=cova[simons.control.para.est[[mut]]$pick.cova.index]
cova.fea=matrix(nrow=1, ncol=length(pick.cova))


simons.control.conf.inter=matrix(nrow=length(pick.cova), ncol=2)
colnames(simons.control.conf.inter)=c("lower", "upper")
rownames(simons.control.conf.inter)=pick.cova


for (i in 1:length(pick.cova))
{
  
  cova.fea[1,i]=simons.control.para.est[[mut]]$para.est[i+1]
  simons.control.conf.inter[i,]=simons.control.para.est[[mut]]$para.conf[i+1,]
  
  
}
colnames(cova.fea)=pick.cova

barcenters=barplot(cova.fea, beside=T,ylab=expression(paste(beta)),col=c("red"), legend=c("simons_contr_100bp"), ylim=c(min(simons.control.conf.inter), max(simons.control.conf.inter)),  main=mut.type[mut],  cex.names=0.65, args.legend = list(x ='topright', bty='n', inset=c(-0.005,0), cex=0.8), xpd = FALSE, las=2)


segments(barcenters, simons.control.conf.inter[,1],  barcenters,simons.control.conf.inter[,2], lwd = 1.5)

arrows(barcenters, simons.control.conf.inter[,1], barcenters,simons.control.conf.inter[,2], lwd = 1.5, angle = 90,code = 3, length = 0.05)
} # end of mut
```


* compute the raio of confidence interval over absolute value of estimated coefficient, rank them, and  choose maximum of the top 25% quanitle  or 1. That is at least there are 25% covariate features with smallest ratios are selected as significant features.  





## Session information


<!-- Insert the session information into the document -->
```{r session-info}
```
