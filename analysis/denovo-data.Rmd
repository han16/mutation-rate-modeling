---
title: "De novo mutations of ASD"
author: "Shengtong  Han"
date: YYYY-MM-DD
output: html_document
---

<!-- The file analysis/chunks.R contains chunks that define default settings
shared across the workflowr files. -->
```{r read-chunk, include=FALSE, cache=FALSE}
knitr::read_chunk("chunks.R")
library(knitr)
```

<!-- Update knitr chunk options -->
```{r knitr-opts-chunk, include=FALSE}
```

<!-- Insert the date the file was last updated -->
```{r last-updated, echo=FALSE, results='asis'}
```

<!-- Insert the code version (Git commit SHA1) if Git repository exists and R
 package git2r is installed -->
```{r code-version, echo=FALSE, results='asis'}
```

```{r, echo=F}
loadRData <- function(fileName){
#loads an RData file, and returns it
    load(fileName)
    get(ls()[ls() != "fileName"])
}
```


## Samples



### Case Samples 



index    | Samples | \# mutations| \# subjects
----|-------|-------|---
1 | Jiang_cases_DNM.bed | 2,091| 32
2 | Michaelson_cases_DNM.bed |581 | 10
3 | Yuen_NM2015_cases_DNM.bed | 9,381| 162
4 | Wu_cases_DNM.bed | 1,915 | 32
5 | Kong_cases_DNM.bed | 4,930 | 78

Table: Five WGS  DNM case sample information



### Wong_NC_2016_693_control_SNV- Control sample 

index    | Samples | \# mutations| \# subjects
----|-------|-------|---
1 | Wong_NC_2016_693_control_SNV.bed | 27,092|  693
2 | A->C | 990 (3.65%) | 
3 | A->G | 3,812 (14.07%) |
4 | A->T | 815 (3.01%) |
5 | C->G | 1,274 (4.70%) |
6 | C->T | 5,314 (19.61%) |
7 | C->A | 1,298 (4.79%) |
Table:WGS  DNM control sample information 

```{r, echo=F}
slices <- c(990, 3812, 815, 1274, 5314, 1298) 
lbls <- c("A->C", "A->G", "A->T", "C->G", "C->T", "C->A")
pct <- round(slices/sum(slices)*100)
lbls <- paste(lbls, pct) # add percents to labels 
lbls <- paste(lbls,"%",sep="") # ad % to labels 
pie(slices,labels = lbls, col=rainbow(length(lbls)),
  	main="Percentage of mutation types in Wong_NC_2016_693_control_SNV ")
```


There are 585,017,944 C's  and 844,868,045 A's in hg19. 



### Jonsson_Yuen2017
De novo WGS of the combination of 1629 ASD cases and 1548 controls. 

index    | mutation type | \# mutations
----|-------|-------|---
1 | A->C | 7,821   
2 | A->G | 29,370  
3 | A->T | 7,417
4 | C->G | 10,255 
5 | C->T | 45,638 
6 | C->A | 9,804

```{r, echo=F}
slices <- c(7821, 29370, 7417, 10255, 45638, 9804) 
lbls <- c("A->C", "A->G", "A->T", "C->G", "C->T", "C->A")
pct <- round(slices/sum(slices)*100)
lbls <- paste(lbls, pct) # add percents to labels 
lbls <- paste(lbls,"%",sep="") # ad % to labels 
pie(slices,labels = lbls, col=rainbow(length(lbls)),
  	main="Percentage of mutation types in Jonsson_Yuen2017 ")
```

## Data processing and model fitting 

### Data discretization and categorization

* Continuous features are converted  into  binary discrete variables.  
* use R function Split to cluster windows with similar binary (original and converted) features.  

### Model fitting for each mutation type separately 

There are two ways to fit the model, GLM and optims. Both methods give the same esrimate either for whole genome or categorized windows as whown in simulations. Here only present the result by GLM with categorization,   

* GLM (use R function GLM) with offset term
  
  $$y\sim Pois( e^{\mu+X^T\beta})$$

  
  (1) With categorization,  response   $y$ is the ** number of mutations ** from all windows  within a category and covariate feature
  (2) offset term uses 7-mer ERV baseline mutation rate, which is sum of 7mer-mutation rate in a window for each mutation type, e.g. for A->C, sum over all 7-mer mutation rate with A->C in the center.     
  
  (2) intercept is included and the same across all categories
  (3) confidence interval could be obtained as well


## ERV baseline mutation rate 

index  | mutation type |  mutations rate  
----|-------|-------|---
1 | A->C | $1.6627\times 10^{-9}$   
2 | A->G | $6.1805 \times 10^{-9}$
3 | A->T | $1.5633 \times 10^{-9}$
4 | C->G | $2.8075 \times 10^{-9}$
5 | C->T | $1.2885 \times 10^{-8}$
6 | C->A | $3.3977 \times 10^{-9}$
Table: Average mutation rate of different mutation types in ERV paper. 


## Wong_NC_2016_693_control_SNV 

The window length is set 100 bp. Use GLM to fit the model, and stated otherwise. 


### Whole genome-14 features 


```{r, echo=F}
mut.type=c("A_to_C", "A_to_G", "A_to_T", "C_to_A.CpG","C_to_A.nonCpG", "C_to_G.nonCpG", "C_to_T.CpG", "C_to_T.nonCpG")
cova=c("DHS", "CpGisland", "Lamin", "GC", "RT", "RR", "Exon", "H3K27ac", "H3K27me3", "H3K36me3", "H3K4me1","H3K4me3","H3K9ac", "H3K9me3")
```


```{r, echo=F}
all.para.est=list()
for (i in 1:length(mut.type))
  all.para.est[[i]]=loadRData(paste("D:\\ResearchWork\\StatisticalGenetics\\Mutation-Rate-project\\parameter_estimate\\Wong_NC_2016_693_control_SNV_100bp.window_mutation", mut.type[i], "RData", sep="."))
names(all.para.est)=mut.type
```

```{r, echo=F}
for (cova.index in 1:length(cova))
{
cova.across.mut=matrix(nrow=1, ncol=length(mut.type))
conf.inter=matrix(nrow=length(mut.type), ncol=2)
colnames(conf.inter)=c("lower", "upper")
rownames(conf.inter)=names(all.para.est)
for (i in 1:length(mut.type))
{
  cova.across.mut[1,i]=all.para.est[[i]]$para.est[cova.index+1]
  conf.inter[i,]=all.para.est[[i]]$para.conf[cova.index+1,]
}
colnames(cova.across.mut)=names(all.para.est)

barcenters=barplot(cova.across.mut, beside=T,ylab=expression(paste(beta)),col=c("red"), ylim=c(min(conf.inter, cova.across.mut), max(conf.inter, cova.across.mut)),  main=cova[cova.index],  cex.names=0.65, args.legend = list(x ='topright', bty='n', inset=c(-0.07,0), cex=0.8), xpd = FALSE, las=2)


segments(barcenters[1,], conf.inter[,1], barcenters[1,],conf.inter[,2], lwd = 1.5)

arrows(barcenters[1,], conf.inter[,1], barcenters[1,], conf.inter[,2] , lwd = 1.5, angle = 90,
       code = 3, length = 0.05)
}
```


* Fit 14 covariate features simultaneously.

* 95% confidence interval by GLM is often big.  





## Jonsson_Yuen2017


```{r, echo=F, eval=F}
all.para.est=list()
for (i in 1:length(mut.type))
  all.para.est[[i]]=loadRData(paste("D:\\ResearchWork\\StatisticalGenetics\\Mutation-Rate-project\\parameter_estimate\\Jonsson_Yuen\\mutation", mut.type[i], "para.est.RData", sep="."))
names(all.para.est)=mutation
```

```{r, echo=F,eval=F}
for (cova.index in 1:5)
{
cova.across.mut=matrix(nrow=3, ncol=length(mutation))
conf.inter=matrix(nrow=length(mutation), ncol=2)
colnames(conf.inter)=c("lower", "upper")
rownames(conf.inter)=names(all.para.est)
for (i in 1:length(mutation))
{
  cova.across.mut[1,i]=all.para.est[[i]]$glm.cate[cova.index+1]
  cova.across.mut[2,i]=all.para.est[[i]]$optim.before.cate[cova.index]
  cova.across.mut[3,i]=all.para.est[[i]]$optim.cate[cova.index]
  conf.inter[i,]=all.para.est[[i]]$glm.cate.conf[cova.index+1,]
}
rownames(cova.across.mut)=method[2:4]
colnames(cova.across.mut)=names(all.para.est)



barcenters=barplot(cova.across.mut, beside=T,ylab=expression(paste(beta)),col=c("red", "darkblue", "black"), legend=method[2:4], main=cova[cova.index],  cex.names=1, args.legend = list(x ='topright', bty='n', inset=c(-0.07,0), cex=0.8))


segments(barcenters[1,], conf.inter[,1], barcenters[1,],conf.inter[,2], lwd = 1.5)

arrows(barcenters[1,], conf.inter[,1], barcenters[1,], conf.inter[,2] , lwd = 1.5, angle = 90,
       code = 3, length = 0.05)
}
```


## Session information


<!-- Insert the session information into the document -->
```{r session-info}
```
