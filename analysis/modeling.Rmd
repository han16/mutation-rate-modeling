---
title: "Modeling"
author: "Shengtong Han"
date: YYYY-MM-DD
output: html_document
---

<!-- The file analysis/chunks.R contains chunks that define default settings
shared across the workflowr files. -->
```{r read-chunk, include=FALSE, cache=FALSE}
knitr::read_chunk("chunks.R")
```

<!-- Update knitr chunk options -->
```{r knitr-opts-chunk, include=FALSE}
```

<!-- Insert the date the file was last updated -->
```{r last-updated, echo=FALSE, results='asis'}
```

<!-- Insert the code version (Git commit SHA1) if Git repository exists and R
 package git2r is installed -->
```{r code-version, echo=FALSE, results='asis'}
```

<!-- Add your analysis here -->

## Session information

## base level


At every genomic locus, observed number of mutations, $y_i$ is modeled as Poisson distribution as 

$y_i \sim Pois(\mu_i)$

There are several covariates affecting the mutation rate, such as tri-nucleotide context, parents' age, etc. To relate the mutation rate to covariates $X_i$, Poisson regression could be one way to do that 

$log(E(y_i|X_i))=log(\mu_i)=X_i^T\beta$

Thus 

$\mu_i=e^{X_i^T\beta}$. 

With parameters estimates, we have 

$\hat{\mu_i}=e^{X_i^T\hat{\beta}}$


If we already have baseline mutation rate, say $\hat{\mu}_{i0}$, we can adjust 

$\mu_i=\hat{\mu}_{i0} e^{X_i^T\beta}$


Mutation rate at single base may be largely influenced by its local context, thus it would be more reasonable to adjust by region level mutation rate. 


## region level

With the base level mutation rate estimate, the mutation rate in a region can be obtained simply by adding the locals 

$\hat{\mu}=\sum_i \hat{\mu}_i$

Let $y$ be the observed number of mutations in the same region.  If $y>\hat{\mu}$, observed mutation rate is higher than estimated. 

Define $\lambda$ as the local deviation. Treat the region as a unit, similarly, the number of mutations in a region follows Poisson distribution 

$y \sim Pois(\lambda \mu)$

Use Gamma as its prior, 

$\lambda \sim Ga(\alpha, \alpha)$

Thus the posterior of $\lambda$ is 

$$
\begin{aligned}
 \lambda|y  & \propto P(\lambda) \times P(y|\lambda \mu)  \\
   & \propto \lambda ^{\alpha+y-1} e^{-\lambda(\alpha+\mu)}
\end{aligned}
$$


$\lambda|y \sim Ga(\alpha+y, \alpha+\mu)$


<!-- Insert the session information into the document -->
```{r session-info}
```
