---
title: "Simons control WGS"
output: html_document
---


```{r, echo=F, message=F, warning=F}
library(tidyverse)
```

## Mutation count partition by mutation types 

WGS Simons control data

index    | mutation type | \# mutations
----|-------|-------|---
1 | A->C (+ T->G) | 3,899+3,900=7,799
2 | A->G (+ T->C) | 15,083+14,919=30,002  
3 | A->T (+ T->A) | 3,664+3,743=7,407
4 | C->G (+ G->C) | 5,393+5,308=10,701
5 | C->T (+ G->A) | 23,977+23,907=47,884 
6 | C->A (+ G->T)| 5,404+5,652=11,056

```{r, echo=F}
slices <- c(7799, 30002, 7404, 10701, 47884, 11056) 
lbls <- c("A->C", "A->G", "A->T", "C->G", "C->T", "C->A")
pct <- round(slices/sum(slices)*100)
lbls <- paste(lbls, pct) # add percents to labels 
lbls <- paste(lbls,"%",sep="") # ad % to labels 
pie(slices,labels = lbls, col=rainbow(length(lbls)),
  	main="Percentage of mutation types in Simons control data ")
```


## Model evalulation 

* Model 1 (M1): 3-mer+features for 9 mutation types

* Model 2 (M2): 3-mer only  for 9 mutation types. This is implemented by enforcing all parameters to be zero in M1.  

* Model 3 (M3): 3-mer+features for pooled 9 mutation types 

### Predictive density measure 

* Whole human genome (hg19) is evenly split into 100bp windows 
* use even (odd) windows as training data to estimate parameters $\beta$
* use another half odd (even) windows as validation data to make prediction 
* windows with predicted density as `NaN` due to $\widehat{\mu}_j=0$ are removed 

#### M1 vs M2 by mutation types 

```{r, echo=F}
path="C:/Shengtong/Research/mutation-rate/mutation-rate-modeling/data/post.predictive.density"
m1.post.pred=tibble()
m2.post.pred=tibble()
m1.post.pred=as_tibble(read.table(paste(path, "post.pred.for.model.txt", sep="/"), header=T))
m2.post.pred=as_tibble(read.table(paste(path, "post.pred.for.model.with.zero.coefficient.and.intercept.txt", sep="/"), header=T))
m1.m2.combine=bind_rows(m1.post.pred, m2.post.pred)%>%add_column(model=c(rep("M1", 18), rep("M2", 18)))
################## plot them 

ggplot(data=m1.m2.combine%>%filter(train.set=="odd"), aes(x=mutation.type, y=-post.pred, fill=model)) +
   theme(axis.text.x = element_text(angle = 90, vjust = 0.5, size=5))+
theme(text = element_text(size=10))+
geom_bar(stat="identity", position=position_dodge())+
   ylab("-log(pred.prob)")+
   ggtitle("odd widow as train set and even as validation")+
  theme(plot.title = element_text(hjust = 0.5, size=10)) # center the title

ggplot(data=m1.m2.combine%>%filter(train.set=="even"), aes(x=mutation.type, y=-post.pred, fill=model)) +
   theme(axis.text.x = element_text(angle = 90, vjust = 0.5, size=5))+
theme(text = element_text(size=10))+
geom_bar(stat="identity", position=position_dodge())+
    ylab("-log(pred.prob)")+
   ggtitle("even widow as train set and odd as validation")+
  theme(plot.title = element_text(hjust = 0.5, size=10)) # center the title
```

#### three models regardless of mutation types 

* M1, M2 sum over all predicted probabilities across 9 mutation types  



```{r, echo=F}
m3.post.pred=as_tibble(read.table(paste(path, "pooled.mutation.type.log.predictive.density.txt", sep="/"), header=T))
pp3=m3.post.pred%>%select(post.pred)%>%summarise(sum=sum(post.pred))%>%pull()
pp1=m1.post.pred%>%select(post.pred)%>%summarise(sum=sum(post.pred))%>%pull()
pp2=m2.post.pred%>%select(post.pred)%>%summarise(sum=sum(post.pred))%>%pull()  
total.post.pred=tibble(model=c("M1", "M2", "M3"), post.pred=c(pp1, pp2, pp3))

ggplot(data=total.post.pred, aes(x=model, y=-post.pred)) +
   theme(axis.text.x = element_text(angle = 60, vjust = 0.5, size=10))+
theme(text = element_text(size=10))+
geom_bar(stat="identity", fill="blue")+
    ylab("-log(pred.prob)")+
   #ggtitle("even widow as train set and odd as validation")+
  theme(plot.title = element_text(hjust = 0.5, size=10)) # center the title
```




## Referecnce 

[Genomic Patterns of De Novo Mutation in Simplex Autism](https://pubmed.ncbi.nlm.nih.gov/28965761/), cell, 2017